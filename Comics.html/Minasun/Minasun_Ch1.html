<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß—Ç–µ–Ω–∏–µ –∫–æ–º–∏–∫—Å–∞</title>
    <link rel="stylesheet" href="../../Comics.html/PROB_Com.css">
</head>

<body class="dark-theme vertical-mode">
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div class="container">
        <div class="comic-viewer">
            <div class="nav-area prev-area" onclick="prevPage()"></div>
            <img src="" alt="–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–º–∏–∫—Å–∞" class="comic-image loading" id="comicImage">
            <div class="nav-area next-area" onclick="nextPage()"></div>
        </div>
    </div>

    <!-- –ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–º–∏–∫—Å–∞ -->
    <div class="end-screen" id="endScreen">
        <div class="end-content">
            <h1 class="end-title">–ì–ª–∞–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>
            <p class="end-message">–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ —ç—Ç—É –≥–ª–∞–≤—É. –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ –∏ —É–∑–Ω–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –¥–∞–ª—å—à–µ?</p>
            
            <div class="end-buttons">
                <a href="../Minasun/Minasun_Ch2.html" class="end-btn next-chapter-btn">
                    <span class="end-icon">‚Üí</span>
                    <span>–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞</span>
                </a>
                <button class="end-btn restart-chapter-btn" onclick="restartChapter()">
                    <span class="end-icon">‚Üª</span>
                    <span>–ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –≥–ª–∞–≤—É</span>
                </button>
                <button class="end-btn close-end-btn" onclick="closeEndScreen()">
                    <span class="end-icon">√ó</span>
                    <span>–ó–∞–∫—Ä—ã—Ç—å</span>
                </button>
            </div>
        </div>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>
    <button class="toggle-panel-btn" onclick="togglePanel()">‚ò∞</button>

    <div class="panel-overlay" id="panelOverlay"></div>

    <div class="control-panel" id="controlPanel">
        <div class="panel-header">
            <div class="panel-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∏–∫—Å–æ–º</div>
            <button class="close-btn" onclick="togglePanel()">√ó</button>
        </div>
        <div class="panel-content">
            <div class="panel-section">
                <div class="section-title" onclick="toggleSection('fullscreen-section')">‚ñ∏ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</div>
                <div class="section-content active" id="fullscreen-section">
                    <button class="panel-btn" onclick="toggleFullscreen()">
                        <span>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</span>
                        <span>‚õ∂</span>
                    </button>
                </div>
            </div>

            <div class="panel-section">
                <div class="section-title" onclick="toggleSection('chapters-section')">‚ñ∏ –í—ã–±–æ—Ä –≥–ª–∞–≤—ã</div>
                <div class="section-content" id="chapters-section">
                    <div class="chapter-list">
                        <div class="chapter-item" onclick="window.location.href='../Minasun/Minasun_Ch1.html'">–ì–ª–∞–≤–∞ 1: –û—Å—Ç—Ä–æ–≤</div>
                        <div class="chapter-item" onclick="window.location.href='../Minasun/Minasun_Ch2.html'">–ì–ª–∞–≤–∞ 2: –û–∫–µ–∞–Ω</div>
                        <div class="chapter-item" onclick="window.location.href='../Minasun/Minasun_Ch3.html'">–ì–ª–∞–≤–∞ 3: –ü–æ—Ö–∏—â–µ–Ω–∏–µ</div>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="section-title" onclick="toggleSection('settings-section')">‚ñ∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
                <div class="section-content active" id="settings-section">
                    <div>
                        <span class="setting-label">–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:</span>
                        <div class="btn-group">
                            <button class="btn active" id="verticalBtn" onclick="setScrollMode('vertical')">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π</button>
                            <button class="btn" id="horizontalBtn" onclick="setScrollMode('horizontal')">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π</button>
                        </div>
                    </div>

                    <div>
                        <span class="setting-label">–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞:</span>
                        <div class="btn-group">
                            <button class="btn active" id="darkThemeBtn" onclick="setTheme('dark')">–¢—ë–º–Ω–∞—è</button>
                            <button class="btn" id="lightThemeBtn" onclick="setTheme('light')">–°–≤–µ—Ç–ª–∞—è</button>
                        </div>
                    </div>

                    <div>
                        <span class="setting-label">–Ø—Ä–∫–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</span>
                        <div class="slider-container">
                            <span style="font-size: 20px;">‚òÄÔ∏è</span>
                            <input type="range" min="50" max="100" value="100" class="slider" id="brightnessSlider" oninput="changeBrightness()">
                            <span style="font-size: 20px;">üîÜ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ –≥–ª–∞–≤–∞
        let currentPage = 1;
        let currentChapter = 1;
        const comicImages = [
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/IMG_20250318_164404_767.png?updatedAt=1751554974757",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%91%D0%B5%D0%B7%20%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F299_20250322163419.png?updatedAt=1751565064255",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%91%D0%B5%D0%B7%20%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F299_20250322164751.png?updatedAt=1751565064437",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%91%D0%B5%D0%B7%20%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F299_20250322164755.png?updatedAt=1751565064136",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/IMG_20250424_121519_590.png?updatedAt=1751565425863",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/IMG_20250430_001734_795.png?updatedAt=1751565412298",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%91%D0%B5%D0%B7%20%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F331_20250424115217.png?updatedAt=1751565415770",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%91%D0%B5%D0%B7%20%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F333_20250424123801.png?updatedAt=1751565409211",
            "https://ik.imagekit.io/1ig11ifpa/%D0%9A%D0%BE%D0%BC%D0%B8%D0%BA%D1%81%20%D0%9C%D0%B8%D0%BD%D0%B0%D1%81%D1%83%D0%BD%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/IMG_20250424_114632_119.png?updatedAt=1751565650543",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",

        ];
        const totalPages = comicImages.length;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const comicImage = document.getElementById('comicImage');
        const controlPanel = document.getElementById('controlPanel');
        const panelOverlay = document.getElementById('panelOverlay');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const verticalBtn = document.getElementById('verticalBtn');
        const horizontalBtn = document.getElementById('horizontalBtn');
        const darkThemeBtn = document.getElementById('darkThemeBtn');
        const lightThemeBtn = document.getElementById('lightThemeBtn');
        const fullscreenBtn = document.querySelector('.fullscreen-btn');
        const endScreen = document.getElementById('endScreen');
        const loader = document.getElementById('loader');

        // –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function preloadImages() {
            let loaded = 0;
            const total = comicImages.length;
            
            comicImages.forEach(imgUrl => {
                const img = new Image();
                img.onload = () => {
                    loaded++;
                    if (loaded === total) {
                        // –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                        setTimeout(() => {
                            loader.classList.add('hidden');
                            updatePage();
                        }, 300);
                    }
                };
                img.onerror = () => {
                    loaded++; // –£—á–∏—Ç—ã–≤–∞–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
                    if (loaded === total) {
                        setTimeout(() => {
                            loader.classList.add('hidden');
                            updatePage();
                        }, 300);
                    }
                };
                img.src = imgUrl;
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                (window.innerWidth <= 768);
        }

        // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        if (isMobile()) {
            fullscreenBtn.style.display = 'none';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function togglePanel() {
            controlPanel.classList.toggle('active');
            panelOverlay.classList.toggle('active');

            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            if (controlPanel.classList.contains('active')) {
                const panelContent = controlPanel.querySelector('.panel-content');
                panelContent.scrollTop = 0;
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
        panelOverlay.addEventListener('click', togglePanel);

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('active');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–æ–∫
            const title = section.previousElementSibling;
            if (section.classList.contains('active')) {
                title.innerHTML = title.innerHTML.replace('‚ñ∏', '‚ñæ');
            } else {
                title.innerHTML = title.innerHTML.replace('‚ñæ', '‚ñ∏');
            }
        }

        // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function changePage(newPage) {
            if (newPage < 1 || newPage > totalPages) return;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            comicImage.classList.add('loading');
            
            currentPage = newPage;
            updatePage();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (currentPage === totalPages) {
                setTimeout(() => {
                    endScreen.classList.add('active');
                }, 300);
            } else {
                endScreen.classList.remove('active');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function updatePage() {
            const imageUrl = comicImages[currentPage - 1];
            if (imageUrl) {
                const img = new Image();
                img.onload = () => {
                    comicImage.src = imageUrl;
                    comicImage.classList.remove('loading');
                    
                    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                    if (document.body.classList.contains('horizontal-mode')) {
                        window.scrollTo({
                            left: (currentPage - 1) * window.innerWidth,
                            behavior: 'smooth'
                        });
                    } else {
                        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–≤–µ—Ä—Ö –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    }
                };
                img.onerror = () => {
                    comicImage.classList.remove('loading');
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', imageUrl);
                };
                img.src = imageUrl;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function nextPage() {
            if (currentPage < totalPages) {
                changePage(currentPage + 1);
            } else {
                endScreen.classList.add('active');
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                changePage(currentPage - 1);
                endScreen.classList.remove('active');
            }
        }

        // –†–µ–∂–∏–º –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        function setScrollMode(mode) {
            if (mode === 'vertical') {
                document.body.classList.remove('horizontal-mode');
                document.body.classList.add('vertical-mode');
                verticalBtn.classList.add('active');
                horizontalBtn.classList.remove('active');

                // –°–±—Ä–æ—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                window.scrollTo(0, 0);
            } else {
                document.body.classList.remove('vertical-mode');
                document.body.classList.add('horizontal-mode');
                verticalBtn.classList.remove('active');
                horizontalBtn.classList.add('active');

                // –°–±—Ä–æ—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                window.scrollTo(0, 0);
            }
        }

        // –°–º–µ–Ω–∞ —Ç–µ–º—ã
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                darkThemeBtn.classList.add('active');
                lightThemeBtn.classList.remove('active');
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                darkThemeBtn.classList.remove('active');
                lightThemeBtn.classList.add('active');
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏
        function changeBrightness() {
            const brightnessValue = brightnessSlider.value / 100;
            comicImage.style.filter = `brightness(${brightnessValue})`;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        const swipeThreshold = 30;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–≤–∞–π–ø—ã
            if (controlPanel.classList.contains('active')) return;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
            const xDiff = touchStartX - touchEndX;
            const yDiff = touchStartY - touchEndY;

            // –ï—Å–ª–∏ –≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ, —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã
            if (document.body.classList.contains('vertical-mode')) {
                if (yDiff > swipeThreshold && Math.abs(yDiff) > Math.abs(xDiff)) {
                    // –°–≤–∞–π–ø –≤–Ω–∏–∑ - —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    nextPage();
                } else if (yDiff < -swipeThreshold && Math.abs(yDiff) > Math.abs(xDiff)) {
                    // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    prevPage();
                }
            }
            // –ï—Å–ª–∏ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ, —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã
            else {
                if (xDiff > swipeThreshold && Math.abs(xDiff) > Math.abs(yDiff)) {
                    nextPage(); // –°–≤–∞–π–ø –≤–ª–µ–≤–æ
                } else if (xDiff < -swipeThreshold && Math.abs(xDiff) > Math.abs(yDiff)) {
                    prevPage(); // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ —ç–∫—Ä–∞–Ω—É
        document.addEventListener('click', (e) => {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –∏ –ø–∞–Ω–µ–ª–∏
            if (e.target.closest('.toggle-panel-btn, .fullscreen-btn, .control-panel, .panel-overlay, .end-screen, .next-chapter-btn, .restart-chapter-btn, .close-end-btn')) {
                return;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –±—ã–ª –∫–ª–∏–∫
            const windowWidth = window.innerWidth;
            const clickX = e.clientX;

            if (clickX < windowWidth * 0.3) {
                // –ö–ª–∏–∫ –≤ –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                prevPage();
            } else if (clickX > windowWidth * 0.7) {
                // –ö–ª–∏–∫ –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ - —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                nextPage();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –ø–æ ESC
            if (e.key === 'Escape' && controlPanel.classList.contains('active')) {
                togglePanel();
                return;
            }

            if (e.key === 'ArrowRight' || e.key === ' ') {
                nextPage();
            } else if (e.key === 'ArrowLeft') {
                prevPage();
            } else if (e.key === 'ArrowDown' && document.body.classList.contains('vertical-mode')) {
                nextPage();
            } else if (e.key === 'ArrowUp' && document.body.classList.contains('vertical-mode')) {
                prevPage();
            } else if (e.key === 'Escape' && endScreen.classList.contains('active')) {
                closeEndScreen();
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≥–ª–∞–≤—ã
        function restartChapter() {
            changePage(1);
            endScreen.classList.remove('active');
        }

        function closeEndScreen() {
            endScreen.classList.remove('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setScrollMode('vertical');
        preloadImages(); // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    </script>
</body>

</html>